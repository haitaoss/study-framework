// gradle -PbuildProfile=task-execution ok -q
// gradle -PbuildProfile=task-execution broken -q

// 可以在执行任何任务之前和之后立即收到通知。
tasks.register('ok')

tasks.register('broken') {
    dependsOn ok
    doLast {
        throw new RuntimeException('broken')
    }
}

gradle.taskGraph.beforeTask { Task task ->
    println "executing $task ..."
}

gradle.taskGraph.afterTask { Task task, TaskState state ->
    if (state.failure) {
        println "FAILED"
    } else {
        println "done"
    }
}